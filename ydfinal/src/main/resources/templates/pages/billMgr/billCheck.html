<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">

<th:block layout:fragment="content">

	<link rel="stylesheet"
		href="https://cdn.datatables.net/v/bs5/dt-1.12.1/datatables.min.css" />
	<script
		src="https://cdn.datatables.net/v/bs5/dt-1.12.1/datatables.min.js"></script>
	<!-- 상단 내비바 -->
	<th:block th:replace="fragments/navbar :: navbarFragment"></th:block>

	<!-- 본문 start -->
	<form action="billCheckInfo">
		<div class="row">
			<div class="col-md-3">
				<div class="input-group input-group-outline my-3">
					<label class="form-label"></label> <input type="number"
						class="form-control" name="billYear" id="billYear">
				</div>
			</div>
			<div class="col-md-3">
				<div class="input-group input-group-outline my-3">
					<label class="form-label"></label> <select class="form-control"
						name="billSem" id="billSem">
						<option value="1">1학기</option>
						<option value="2">2학기</option>
					</select>
				</div>
			</div>
			<div class="col-md-3">
				<div class="input-group input-group-outline my-3">
					<button class="btn bg-gradient-primary">조회</button>
				</div>
			</div>
	</form>

	<h5>상세</h5>
	<th:block th:each="bill:${billCheckInfo}">
		<div class="row justify-content-center">
			<div class="card">
				<div class="table-responsive">
					<table class="table text-center mb-0" id="payList">
						<tr>
							<td class="table-secondary">년도</td>
							<td th:text="${bill.billYear}"></td>
							<td class="table-secondary">학기</td>
							<td th:text="${bill.billSem}"></td>
						</tr>
						<tr>
							<td class="table-secondary">학번</td>
							<td th:text="${bill.userId}"></td>
							<td class="table-secondary">이름</td>
							<td th:text="${bill.userName}"></td>
						</tr>
						<tr>
							<td class="table-secondary">학과</td>
							<td th:text="${bill.userDept}"></td>
							<td class="table-secondary">학년</td>
							<td th:text="${bill.payHGrade}"></td>
						</tr>
						<tr hidden="">
							<td th:text="${bill.payId}" name="payId" id="payId"></td>
						</tr>
						<span th:if="${bill.payHType.toString().equals('b')}">
							<tr>
								<td class="table-secondary">등록금 총액</td>
								<td th:text="${bill.billAmount}"></td>
								<td class="table-secondary">납부방식</td>
								<td><span th:if="${bill.payHType.toString().equals('b')}">일괄납부</span>
									<span th:if="${bill.payHType.toString().equals('s1')}">분할납부A</span>
									<span th:if="${bill.payHType.toString().equals('s2')}">분할납부B</span>
								</td>
							</tr>
						<tr>
							<td class="table-secondary">납부기간</td>
							<td></td>
						</tr>
						<tr>
							<td class="table-secondary">가상계좌</td>
							<td></td>
						</tr>
						</span>
						<span th:if="${bill.payHType.toString().equals('s1')}">
							<tr>
								<td class="table-secondary">등록금 총액</td>
								<td th:text="${bill.billAmount}"></td>
								<td class="table-secondary">납부방식</td>
								<td><span th:if="${bill.payHType.toString().equals('b')}">일괄납부</span>
									<span th:if="${bill.payHType.toString().equals('s1')}">분할납부A</span>
									<span th:if="${bill.payHType.toString().equals('s2')}">분할납부B</span>
								</td>
							</tr>
							<tr>
								<td class="table-secondary">1차 분납금액</td>
								<td th:text="${bill.a}">></td>
								<td class="table-secondary">납부기간</td>
								<td></td>
							</tr>
							<tr>
								<td class="table-secondary">2차 분납금액</td>
								<td th:text="${bill.b}"></td>
								<td class="table-secondary">납부기간</td>
								<td></td>
							</tr>
							<tr>
								<td class="table-secondary">3차 분납금액</td>
								<td th:text="${bill.c}"></td>
								<td class="table-secondary">납부기간</td>
								<td></td>
							</tr>
							<tr>
								<td class="table-secondary">4차 분납금액</td>
								<td th:text="${bill.d}"></td>
								<td class="table-secondary">납부기간</td>
								<td></td>
							</tr>
							<tr>
								<td class="table-secondary">가상계좌</td>
								<td></td>
							</tr>
						</span>
						<span th:if="${bill.payHType.toString().equals('s2')}">
							<tr>
								<td class="table-secondary">등록금 총액</td>
								<td th:text="${bill.billAmount}"></td>
								<td class="table-secondary">납부방식</td>
								<td><span th:if="${bill.payHType.toString().equals('b')}">일괄납부</span>
									<span th:if="${bill.payHType.toString().equals('s1')}">분할납부A</span>
									<span th:if="${bill.payHType.toString().equals('s2')}">분할납부B</span>
								</td>
							</tr>
							<tr>
								<td class="table-secondary">1차 분납금액</td>
								<td th:text="${bill.a}">></td>
								<td class="table-secondary">납부기간</td>
								<td></td>
							</tr>
							<tr>
								<td class="table-secondary">2차 분납금액</td>
								<td th:text="${bill.b}">></td>
								<td class="table-secondary">납부기간</td>
								<td></td>
							</tr>
						<tr>
							<td class="table-secondary">가상계좌</td>
							<td></td>
						</tr>
						</span>
					</table>
				</div>
			</div>
		</div>

		<span th:if="${bill.payHType.toString().equals('b')}">
			<div class="col-md-3">
				<div class="input-group input-group-outline my-3">
					<button type="button" class="btn btn-primary change"
						data-bs-toggle="modal" data-bs-target="#change"
						data-bs-whatever="NO">분할 납부 신청</button>
				</div>
			</div>
		</span>



		<div class="modal fade" id="change" tabindex="-1"
			aria-labelledby="changeLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="changeLabel">납부 방식 선택</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<div class="modal-body">
					<p>납부 방식 변경은 1회만 가능합니다. 신중하게 결정해주세요.</p>
						<form action="payChange">
							<div class="mb-3">
								<select class="form-control" name="payHType" id="payHType">
									<option value="s1">분할납부A (4회 분할 납부)</option>
									<option value="s2">분할납부B (2회 분할 납부)</option>
								</select>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">닫기</button>
						<button type="button" class="btn btn-primary NO">변경</button>
					</div>
				</div>
			</div>
		</div>

	</th:block>

	<script>
		let date = new Date();
		let year = document.getElementById('billYear');
		year.value = date.getFullYear();
		
		$(".change").on("click", function () {
			var id = ($(this).closest("table").find("td#payId").text())
	   		console.log(id)
		});
	</script>

	<!-- 본문 end-->
</th:block>
</html>