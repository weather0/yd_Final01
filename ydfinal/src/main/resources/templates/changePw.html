<!--로그인 페이지-->
<!-- login.html-->
<!DOCTYPE html>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="apple-touch-icon" sizes="76x76" href="./img/apple-icon.png">
<link rel="icon" type="image/png" href="./img/favicon.png">
<title>예담직업전문학교</title>
<!--     Fonts and icons     -->
<link rel="stylesheet" type="text/css"
	href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700" />
<!-- Nucleo Icons -->
<link href="./css/nucleo-icons.css" rel="stylesheet" />
<link href="./css/nucleo-svg.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.1.js"
	integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
	crossorigin="anonymous"></script>
<!-- Font Awesome Icons -->
<script src="https://kit.fontawesome.com/42d5adcbca.js"
	crossorigin="anonymous"></script>
<!-- Material Icons -->
<link
	href="https://fonts.googleapis.com/icon?family=Material+Icons+Round"
	rel="stylesheet">
<!-- CSS Files -->
<link id="pagestyle" href="./css/material-dashboard.css?v=3.0.0"
	rel="stylesheet" />
<!-- alert -->
<link
	href='https://cdn.jsdelivr.net/npm/sweetalert2@11.4.33/dist/sweetalert2.css'
	rel='stylesheet' />
<script type="text/javascript"
	src='https://cdn.jsdelivr.net/npm/sweetalert2@11.4.33/dist/sweetalert2.all.min.js'></script>
<style>
.page-header {
	margin: 0;
	border-bottom: none;
}

.alert {
	color: #FA7070;
	font-size: 12px;
	font-weight: 700;
	margin-bottom: 0 !important;
	padding-bottom: 0 !important;
}
</style>
</head>
<body class="bg-gray-200">
	<!--로그인 페이지-->
	<!-- login.html-->
	<!DOCTYPE html>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet"
		href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="apple-touch-icon" sizes="76x76" href="./img/apple-icon.png">
<link rel="icon" type="image/png" href="./img/favicon.png">
<title>예담직업전문학교</title>
<!--     Fonts and icons     -->
<link rel="stylesheet" type="text/css"
	href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700" />
<!-- Nucleo Icons -->
<link href="./css/nucleo-icons.css" rel="stylesheet" />
<link href="./css/nucleo-svg.css" rel="stylesheet" />
<!-- Material Icons -->
<link
	href="https://fonts.googleapis.com/icon?family=Material+Icons+Round"
	rel="stylesheet">
<!-- CSS Files -->
<link id="pagestyle" href="./css/material-dashboard.css?v=3.0.0"
	rel="stylesheet" />
<!-- Font Awesome Icons -->
<script src="https://kit.fontawesome.com/42d5adcbca.js"
	crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.js"
	integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
	crossorigin="anonymous"></script>
<style>
.page-header {
	margin: 0;
	border-bottom: none;
}
</style>
</head>
<body class="bg-gray-200">
	<main class="main-content  mt-0">
		<div class="page-header align-items-start min-vh-100">
			<video muted autoplay playsinline loop width="100%">
				<source src="/aa/video/homeClip-sm.mkv" type="video/mp4">
				<strong>Your browser does not support the video tag.</strong>
			</video>
			<div class="container my-auto">
				<div class="row">
					<div class="col-lg-4 col-md-8 col-12 mx-auto">
						<div class="card z-index-0 fadeIn3 fadeInBottom">
							<div class="card-body">
								<div class="text-center mt-2 mb-4" style="color: #0a2351">
									<img class="img-fluid" src='/aa/logo/KCYlogo.png' alt='KCYlogo'>
								</div>
								<input type="hidden" th:value="${info.userEmail}"
									th:id="userEmail" />
								<div class="input-group input-group-outline my-3">
									<label th:for="myName" class="form-label"></label> <input
										type="text" id="myName" th:value="${info.userId}"
										name="myName" class="form-control" readonly="readonly">
								</div>
								<div class="input-group input-group-outline mb-3">
									<label th:for="myName" class="form-label"></label> <input
										type="text" id="myName" th:value="${info.myName}"
										name="myName" class="form-control" readonly="readonly">
								</div>
								<div class="input-group input-group-outline mb-3">
									<label th:for="newPassword" class="form-label"></label> <input
										type="password" th:id="newPw" name="newPw"
										placeholder="비밀번호를 입력해 주세요." class="form-control" required>
								</div>
								<div class="input-group input-group-outline mb-3">
									<label th:for="newPasswordConfirm" class="form-label"></label>
									<input type="password" id="newPasswordConfirm"
										placeholder="비밀번호를 다시 입력해 주세요." name="changePwTwo"
										class="form-control" required>
								</div>
								<p id="success" style="display: none; color: #42855B;"
									class="alert">비밀번호가 일치합니다.</p>
								<p id="error" style="display: none" class="alert">비밀번호가 일치하지
									않습니다.</p>
								<div class="text-center">
									<button type="button" id="checkEmail"
										class="btn bg-gradient-dark w-100 my-4 mb-2">변경</button>
								</div>
								<hr>
								<div class="text-center small mt-2" id="checkMsg"
									style="color: red"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
	<script>
	
	$("input").keyup(function() {
		
        let userPw = $("#newPw").val();
        let confirmPw = $("#newPasswordConfirm").val();
		
		if(userPw != "" || confirmPw !="") {
			if(userPw == confirmPw) {
				$("#success").css('display', 'inline-block');
				$("#error").css('display', 'none');
			} else {
				$("#error").css('display', 'inline-block');
				$("#success").css('display', 'none');
				return false;
			}
		}
	})

	 $("#checkEmail").click(function () {
	        let userEmail = $("#userEmail").val();
	        let userPw = $("#newPw").val();
	        let userName = $("#myName").val();

        	$.ajax({
        		url: "/changePw/proc",
       		 	dataType: "json",
        		data: {
        			"userEmail": userEmail,
        			"newPw": userPw
        		},
        		beforeSend: function() {
        			
        			if(userEmail != null && userName != null && userPw != null) {
        			     let number = userPw.search(/[0-9]/g);
        			     let english = userPw.search(/[a-z]/ig);
        			     let space = userPw.search(/[`~!@@#$%^&*|₩₩₩'₩";:₩/?]/gi);

        			        if (userPw.length < 8 || userPw.length > 20) {
        			            Swal.fire("오류 발생", "8자리 ~ 20자리 이내로 입력해 주세요.", "error");
        			            return false;

        			        } else if (userPw.search(/\s/) != -1) {
        			            Swal.fire("오류 발생", "비밀번호는 공백 없이 입력해 주세요.", "error");
        			            return false;

        			        } else if ((number < 0 && english < 0) || (english < 0 && space < 0) || (space < 0 && number < 0)) {
        			            Swal.fire("오류 발생", "영문, 숫자, 특수문자 중 2가지 이상을 혼합하여 입력해 주세요.", "error");
        			            return false;
        			        }
        			        
        				} else {
        					Swal.fire("오류 발생", "모든 정보를 입력해 주세요.", "error");
        					return false;
        				}
        		},
        		success: function(data) {
        			
        		   Swal.fire("변경 완료", "다시 로그인해 주세요.", "success");
               	   setTimeout(function() {
              		   location.href = "/login"
              		   }, 1000);
        			
        		},
        		error: function(error) {
        			
         		   Swal.fire("변경 완료", "다시 로그인해 주세요.", "success");
               	   setTimeout(function() {
              		   location.href = "/login"
              		   }, 1000);
               	   
        		}
        	})
	    })
	    
	</script>
</body>
</html>